<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Todo List</title>
  <!-- Bootstrap v5.3.7 -->
  <link
    rel="stylesheet"
    href="assets/vendor/bootstrap-5.3.7/package/dist/css/bootstrap.min.css"
  />
  <!-- Bootstrap Icons v1.13.1 -->
  <link
    rel="stylesheet"
    href="assets/vendor/bootstrap-icons-1.13.1/package/font/bootstrap-icons.min.css"
  />
  
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #f198cf 0%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --dark-bg: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    }

    body {
      background: linear-gradient(135deg, #d6b2ce 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .container {
      max-width: 800px;
    }

    .main-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .todo-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .todo-header h1 {
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .todo-subtitle {
      color: #6c757d;
      font-size: 1.1rem;
      margin-bottom: 0;
    }

    .form-control, .form-select {
      border-radius: 15px;
      border: 2px solid #e9ecef;
      padding: 0.75rem 1rem;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
    }

    .form-control:focus, .form-select:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
      background: rgba(255, 255, 255, 1);
    }

    .btn {
      border-radius: 15px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
    }

    .btn-primary {
      background: var(--primary-gradient);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-success {
      background: var(--success-gradient);
      box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
    }

    .btn-outline-primary {
      background: transparent;
      border: 2px solid #667eea;
      color: #667eea;
    }

    .btn-outline-primary:hover {
      background: var(--primary-gradient);
      border-color: transparent;
      color: white;
      transform: translateY(-1px);
    }

    .btn-outline-danger {
      background: transparent;
      border: 2px solid #fa709a;
      color: #fa709a;
    }

    .btn-outline-danger:hover {
      background: var(--danger-gradient);
      border-color: transparent;
      color: white;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      color: white;
    }

    .filter-search-row {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      backdrop-filter: blur(10px);
    }

    .list-group-item {
      border-radius: 15px !important;
      margin-bottom: 0.75rem;
      border: 2px solid #e9ecef;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      padding: 1rem 1.5rem;
    }

    .list-group-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      border-color: #667eea;
    }

    .sortable-ghost {
      opacity: 0.4;
      transform: rotate(5deg);
    }
    
    .drag-handle {
      cursor: grab;
      padding: 0.5rem;
      border-radius: 10px;
      transition: all 0.2s ease;
    }

    .drag-handle:hover {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
    }
    
    .drag-handle:active {
      cursor: grabbing;
    }
    
    .editing-mode {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%) !important;
      border-color: #ffc107 !important;
      box-shadow: 0 0 20px rgba(255, 193, 7, 0.3) !important;
    }
    
    .edit-input {
      border: 2px solid #ffc107 !important;
      border-radius: 10px !important;
      background: rgba(255, 255, 255, 0.9) !important;
    }

    .alert {
      border-radius: 15px;
      border: none;
      backdrop-filter: blur(10px);
    }

    .alert-danger {
      background: linear-gradient(135deg, rgba(250, 112, 154, 0.1) 0%, rgba(254, 225, 64, 0.1) 100%);
      color: #d63384;
      border-left: 4px solid #fa709a;
    }

    .empty-state {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 20px;
      padding: 3rem 2rem;
      backdrop-filter: blur(10px);
    }

    .todo-checkbox {
      width: 1.25rem !important;
      height: 1.25rem !important;
      border-radius: 50% !important;
      border: 2px solid #667eea !important;
      background: transparent !important;
    }

    .todo-checkbox:checked {
      background: var(--primary-gradient) !important;
      border-color: #667eea !important;
    }

    .todo-label {
      font-size: 1.1rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .todo-label.completed {
      text-decoration: line-through;
      color: #6c757d;
      opacity: 0.7;
    }

    .btn-group-sm .btn {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
      100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <div>


      <h1 style="color: white;">Todo List</h1>
      <hr />

      <!-- Form Tambah -->
      <form id="formData">
        <div class="input-group mb-3">
          <input type="text" class="form-control" name="todo" placeholder="Tambah todo..."/>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-plus"></i> Tambah
          </button>
        </div>
        <div id="validation-error" class="alert alert-danger" style="display: none;"></div>
      </form>

      <!-- Filter & Search -->
      <div class="filter-search-row">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
          <div style="min-width: 200px;">
            <label class="form-label fw-bold">
              <i class="bi bi-funnel me-1"></i>Filter Todos
            </label>
            <select id="filter" class="form-select">
              <option value="all">üåü Semua</option>
              <option value="completed">‚úÖ Selesai</option>
              <option value="pending">‚è≥ Belum Selesai</option>
            </select>
          </div>
          <div style="min-width: 200px;">
            <label class="form-label fw-bold">
              <i class="bi bi-search me-1"></i>Cari Todo
            </label>
            <input type="text" id="search" class="form-control" placeholder="Ketik untuk mencari..."/>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div id="empty-state" class="empty-state text-center" style="display: none;">
        <i class="bi bi-list-ul" style="font-size: 4rem; color: #667eea; opacity: 0.5;"></i>
        <h4 class="mt-3 text-muted">Tidak ada todo yang ditemukan</h4>
        <p class="text-muted">Coba ubah filter atau kata kunci pencarian</p>
      </div>

      <!-- Daftar Todo -->
      <ul class="list-group" id="todoList"></ul>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="/assets/vendor/bootstrap-5.3.7/package/dist/js/bootstrap.bundle.min.js"></script>

  <!-- SortableJS (drag & drop) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

  <!-- Script -->
  <script>
    let todos = [];
    let activeFilter = "all";
    let searchQuery = "";
    let editingIndex = -1;
    let sortableInstance = null;

    // Show validation error
    function showValidationError(message) {
      const errorDiv = document.getElementById("validation-error");
      errorDiv.textContent = message;
      errorDiv.style.display = "block";
      setTimeout(() => {
        errorDiv.style.display = "none";
      }, 3000);
    }

    // Validate todo title (no duplicates, not empty)
    function validateTodo(todoText, excludeIndex = -1) {
      const trimmedTodo = todoText.trim();
      
      if (trimmedTodo === "") {
        return { isValid: false, message: "Todo tidak boleh kosong!" };
      }
      
      const isDuplicate = todos.some((todo, index) => 
        index !== excludeIndex && todo.todo.toLowerCase() === trimmedTodo.toLowerCase()
      );
      
      if (isDuplicate) {
        return { isValid: false, message: "Todo sudah ada!" };
      }
      
      return { isValid: true, message: "" };
    }

    // Get filtered todos based on current filter and search
    function getFilteredTodos() {
      let filteredTodos = todos.filter(item => {
        if (activeFilter === "completed") return item.completed;
        if (activeFilter === "pending") return !item.completed;
        return true;
      });

      // Apply search filter
      if (searchQuery.trim() !== "") {
        filteredTodos = filteredTodos.filter(item =>
          item.todo.toLowerCase().includes(searchQuery.toLowerCase())
        );
      }

      return filteredTodos;
    }

    // Start editing a todo
    function startEdit(todoIndex) {
      editingIndex = todoIndex;
      renderTodos();
    }

    // Save edit
    function saveEdit(todoIndex, newTodo) {
      const validation = validateTodo(newTodo, todoIndex);
      if (!validation.isValid) {
        showValidationError(validation.message);
        return false;
      }

      todos[todoIndex].todo = newTodo.trim();
      editingIndex = -1;
      saveTodos();
      renderTodos();
      return true;
    }

    // Cancel edit
    function cancelEdit() {
      editingIndex = -1;
      renderTodos();
    }

    // Render daftar todo
    function renderTodos() {
      const todoList = document.getElementById("todoList");
      const emptyState = document.getElementById("empty-state");
      todoList.innerHTML = "";

      const filteredTodos = getFilteredTodos();

      // Show empty state if no todos
      if (filteredTodos.length === 0) {
        emptyState.style.display = "block";
        todoList.style.display = "none";
        return;
      }

      emptyState.style.display = "none";
      todoList.style.display = "block";

      filteredTodos.forEach((item, filteredIndex) => {
        // Find the actual index in the main todos array
        const actualIndex = todos.findIndex(t => 
          t.todo === item.todo && t.completed === item.completed
        );

        const li = document.createElement("li");
        li.className = "list-group-item d-flex align-items-center";
        li.setAttribute("data-id", actualIndex);

        if (actualIndex === editingIndex) {
          li.classList.add("editing-mode");
        }

        // Drag handle
        const dragHandle = document.createElement("div");
        dragHandle.className = "drag-handle me-2 text-muted";
        dragHandle.innerHTML = '<i class="bi bi-grip-vertical"></i>';

        if (actualIndex === editingIndex) {
          // Edit mode
          const editInput = document.createElement("input");
          editInput.type = "text";
          editInput.className = "form-control edit-input me-2";
          editInput.value = item.todo;
          editInput.style.flexGrow = "1";

          const saveBtn = document.createElement("button");
          saveBtn.className = "btn btn-sm btn-success me-1";
          saveBtn.innerHTML = '<i class="bi bi-check"></i>';
          saveBtn.type = "button";
          saveBtn.addEventListener("click", () => {
            saveEdit(actualIndex, editInput.value);
          });

          const cancelBtn = document.createElement("button");
          cancelBtn.className = "btn btn-sm btn-secondary";
          cancelBtn.innerHTML = '<i class="bi bi-x"></i>';
          cancelBtn.type = "button";
          cancelBtn.addEventListener("click", cancelEdit);

          // Handle Enter and Escape keys
          editInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              saveEdit(actualIndex, editInput.value);
            } else if (e.key === "Escape") {
              e.preventDefault();
              cancelEdit();
            }
          });

          li.appendChild(dragHandle);
          li.appendChild(editInput);
          li.appendChild(saveBtn);
          li.appendChild(cancelBtn);

          // Auto-focus and select text
          setTimeout(() => {
            editInput.focus();
            editInput.select();
          }, 0);

        } else {
          // Normal mode
          // Checkbox
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "form-check-input todo-checkbox me-3";
          checkbox.checked = item.completed;
          checkbox.addEventListener("change", () => {
            todos[actualIndex].completed = checkbox.checked;
            saveTodos();
            renderTodos();
          });

          // Label
          const label = document.createElement("span");
          label.className = "flex-fill todo-label";
          if (item.completed) {
            label.classList.add("completed");
          }
          label.textContent = item.todo;

          // Edit button
          const editBtn = document.createElement("button");
          editBtn.className = "btn btn-sm btn-outline-primary me-1";
          editBtn.innerHTML = '<i class="bi bi-pencil"></i>';
          editBtn.addEventListener("click", () => {
            startEdit(actualIndex);
          });

          // Delete button
          const delBtn = document.createElement("button");
          delBtn.className = "btn btn-sm btn-outline-danger";
          delBtn.innerHTML = '<i class="bi bi-trash"></i>';
          delBtn.addEventListener("click", () => {
            if (confirm("Apakah Anda yakin ingin menghapus todo ini?")) {
              todos.splice(actualIndex, 1);
              saveTodos();
              renderTodos();
            }
          });

          li.appendChild(dragHandle);
          li.appendChild(checkbox);
          li.appendChild(label);
          li.appendChild(editBtn);
          li.appendChild(delBtn);
        }

        todoList.appendChild(li);
      });

      // Initialize SortableJS
      if (sortableInstance) {
        sortableInstance.destroy();
      }
      
      sortableInstance = Sortable.create(todoList, {
        animation: 150,
        ghostClass: 'sortable-ghost',
        handle: '.drag-handle',
        onEnd: function (evt) {
          // Get the filtered todos
          const filteredTodos = getFilteredTodos();
          
          // Reorder within filtered todos
          const [movedItem] = filteredTodos.splice(evt.oldIndex, 1);
          filteredTodos.splice(evt.newIndex, 0, movedItem);
          
          // Update the main todos array
          updateTodosOrder(filteredTodos);
          saveTodos();
          renderTodos();
        }
      });
    }

    // Update todos order after drag & drop
    function updateTodosOrder(reorderedFilteredTodos) {
      const newTodos = [];
      const usedIndices = new Set();
      
      // Add reordered filtered todos first
      reorderedFilteredTodos.forEach(todo => {
        const originalIndex = todos.findIndex((t, index) => 
          t.todo === todo.todo && t.completed === todo.completed && !usedIndices.has(index)
        );
        if (originalIndex !== -1) {
          newTodos.push(todos[originalIndex]);
          usedIndices.add(originalIndex);
        }
      });
      
      // Add remaining todos that weren't in the filtered list
      todos.forEach((todo, index) => {
        if (!usedIndices.has(index)) {
          newTodos.push(todo);
        }
      });
      
      todos = newTodos;
    }

    // Simpan ke localStorage
    function saveTodos() {
      localStorage.setItem("todos", JSON.stringify(todos));
    }

    // Load todos from localStorage
    function loadTodos() {
      const storedTodos = localStorage.getItem("todos");
      if (storedTodos) {
        todos = JSON.parse(storedTodos);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("formData");
      const filter = document.getElementById("filter");
      const search = document.getElementById("search");

      // Load todos
      loadTodos();

      // Submit todo
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const todoInput = form.todo.value;

        const validation = validateTodo(todoInput);
        if (!validation.isValid) {
          showValidationError(validation.message);
          return;
        }

        todos.unshift({ todo: todoInput.trim(), completed: false });
        form.todo.value = "";
        saveTodos();
        renderTodos();
      });

      // Filter change
      filter.addEventListener("change", () => {
        activeFilter = filter.value;
        renderTodos();
      });

      // Search input
      search.addEventListener("input", () => {
        searchQuery = search.value;
        renderTodos();
      });

      // Initial render
      renderTodos();
    });

    // Save todos when page is closed
    window.addEventListener("beforeunload", saveTodos);
  </script>
</body>
</html>